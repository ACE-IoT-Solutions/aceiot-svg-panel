{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","svgelem","getElementsByClassName","find","plotCanvas","svgnode","events","on","PanelEvents","render","renderingCompleted","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","SVGextend","SVGElement","animateContRotate","speed","animate","ease","rotate","loop","stopAnimation","timeline","stop","SVGDom","updateXHTMLFontText","newText","currentElement","node","localName","firstElementChild","innerHTML","formatter","label","slice","fontSize","color","Math","round","percent","addSVG","parentSVG","SVG","clear","svg","svg_data","resizePlotCanvas","plotCss","top","margin","position","initializeMappings","svgElements","i","svgIdMappings","length","mappedName","findOne","svgId","getAttribute","removeAttribute","initialized","doInit","updateClickMapper","handleMetric","$","extend","Element","Dom","SVGGet","get"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\nimport { SVG, extend as SVGextend, Element as SVGElement, Dom as SVGDom, get as SVGGet } from './node_modules/@svgdotjs/svg.js/dist/svg.min.js';\nimport { PanelEvents } from '@grafana/data';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var panel;\n  var svgelem = elem[0].getElementsByClassName('svg-object')[0];\n  elem = elem.find('.svg-panel');\n  var plotCanvas = elem.find('.plot-canvas');\n  var svgnode;\n\n  ctrl.events.on(PanelEvents.render, function () {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch (e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n  //////// SVG.js Extensions\n  // console.log(\"beginning SVG.js Extensions\");\n  SVGextend(SVGElement, {\n    animateContRotate: function (speed) {\n      return this.animate(1000).ease('-').rotate(360).loop();\n    },\n    stopAnimation: function () {\n      this.timeline().stop();\n    }\n  })\n  SVGextend(SVGDom, {\n    updateXHTMLFontText: function (newText) {\n      let currentElement = this.node;\n      while (currentElement.localName !== \"xhtml:font\") {\n        currentElement = currentElement.firstElementChild;\n      }\n      currentElement.innerHTML = newText;\n    }\n  })\n  // console.log(\"ending SVG.js Extensions\");\n\n  function formatter(label, slice) {\n    return \"<div style='font-size:\" + ctrl.panel.fontSize + \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n  }\n\n  function addSVG() {\n    ctrl.parentSVG = SVG(svgnode);\n    ctrl.parentSVG.clear();\n\n    ctrl.parentSVG.svg(panel.svg_data);\n    // parentSVG.node.append(childSVG.node);\n  }\n\n  function resizePlotCanvas() {\n    var plotCss = {\n      top: '10px',\n      margin: 'auto',\n      position: 'relative',\n      height: elem.height() + 'px'\n    };\n    plotCanvas.css(plotCss);\n  }\n\n  function initializeMappings(svgnode) {\n    ctrl.svgElements = {};\n    for (let i = 0; i < ctrl.panel.svgIdMappings.length; i++) {\n      if (ctrl.panel.svgIdMappings[i].mappedName !== '') {\n        // console.log(ctrl.parentSVG);\n        ctrl.svgElements[ctrl.panel.svgIdMappings[i].mappedName] = ctrl.parentSVG.findOne(`#${ctrl.panel.svgIdMappings[i].svgId}`);\n      }\n    }\n    // console.log(ctrl.svgElements);\n  }\n  function render() {\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      if (svgelem) {\n        svgnode = svgelem;\n\n        if (svgnode.getAttribute(\"name\") == 'isInitial') {\n          svgnode.removeAttribute(\"name\");\n          ctrl.initialized = 0;\n        }\n\n        resizePlotCanvas();\n\n        if (!ctrl.initialized) {\n          addSVG();\n          initializeMappings(svgnode);\n          panel.doInit(ctrl, svgnode);\n          ctrl.updateClickMapper();\n          ctrl.initialized = 1;\n        }\n\n        panel.handleMetric(ctrl, svgnode);\n\n        svgnode = null;\n      }\n      else {\n        ctrl.initialized = 0;\n      }\n    }\n  }\n}\n\n\n"]}