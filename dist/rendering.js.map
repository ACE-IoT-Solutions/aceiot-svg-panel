{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","panel","find","svgelem","svgnode","get","plotCanvas","events","on","render","renderingCompleted","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","formatter","label","slice","fontSize","color","Math","round","percent","addSVG","xml","jQuery","parseXML","svg_data","setAttribute","documentElement","getAttribute","html","children","resizePlotCanvas","width","size","min","plotCss","top","margin","position","initialized","doInit","handleMetric","$"],"mappings":";;;;;;;AAKe,WAASA,IAAT,CAAcC,KAAd,EAAqBC,IAArB,EAA2BC,KAA3B,EAAkCC,IAAlC,EAAwC;AACrD,QAAIC,IAAJ,EAAUC,KAAV;AACAJ,WAAOA,KAAKK,IAAL,CAAU,YAAV,CAAP;AACA,QAAIC,UAAUN,KAAKK,IAAL,CAAU,KAAV,CAAd;AACA,QAAIE,UAAUD,QAAQE,GAAR,CAAY,CAAZ,CAAd;AACA,QAAIC,aAAaT,KAAKK,IAAL,CAAU,cAAV,CAAjB;;AAEAH,SAAKQ,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAW;AAClCC;AACAV,WAAKW,kBAAL;AACD,KAHD;;AAKA,aAASC,gBAAT,GAA4B;AAC1B,UAAI;AACF,YAAIC,SAASb,KAAKa,MAAL,IAAeX,MAAMW,MAArB,IAA+Bb,KAAKc,GAAL,CAASD,MAArD;AACA,YAAIE,EAAEC,QAAF,CAAWH,MAAX,CAAJ,EAAwB;AACtBA,mBAASI,SAASJ,OAAOK,OAAP,CAAe,IAAf,EAAqB,EAArB,CAAT,EAAmC,EAAnC,CAAT;AACD;;AAEDL,kBAAU,CAAV,CANE,CAMW;AACbA,kBAAUX,MAAMiB,KAAN,GAAc,EAAd,GAAmB,CAA7B,CAPE,CAO8B;;AAEhCrB,aAAKsB,GAAL,CAAS,QAAT,EAAmBP,SAAS,IAA5B;;AAEA,eAAO,IAAP;AACD,OAZD,CAYE,OAAMQ,CAAN,EAAS;AAAE;AACX,eAAO,KAAP;AACD;AACF;;AAED,aAASC,SAAT,CAAmBC,KAAnB,EAA0BC,KAA1B,EAAiC;AAC/B,aAAO,2BAA2BxB,KAAKE,KAAL,CAAWuB,QAAtC,GAAiD,uCAAjD,GAA2FD,MAAME,KAAjG,GAAyG,KAAzG,GAAiHH,KAAjH,GAAyH,OAAzH,GAAmII,KAAKC,KAAL,CAAWJ,MAAMK,OAAjB,CAAnI,GAA+J,SAAtK;AACD;;AAED,aAASC,MAAT,GAAkB;AAChB,UAAIC,MAAMC,OAAOC,QAAP,CAAgB/B,MAAMgC,QAAtB,CAAV;;AAEA9B,cAAQE,GAAR,CAAY,CAAZ,EAAe6B,YAAf,CAA4B,SAA5B,EAAuCJ,IAAIK,eAAJ,CAAoBC,YAApB,CAAiC,SAAjC,CAAvC;AACAjC,cAAQkC,IAAR,CAAaP,IAAIK,eAAJ,CAAoBG,QAAjC;AACAlC,gBAAQD,QAAQE,GAAR,CAAY,CAAZ,CAAR;AACD;;AAED,aAASkC,gBAAT,GAA4B;AAC1B,UAAIC,QAAQ3C,KAAK2C,KAAL,EAAZ;AACA,UAAI5B,SAASf,KAAKe,MAAL,EAAb;;AAEA,UAAI6B,OAAOf,KAAKgB,GAAL,CAASF,KAAT,EAAgB5B,MAAhB,CAAX;;AAEA,UAAI+B,UAAU;AACZC,aAAK,MADO;AAEZC,gBAAQ,MAFI;AAGZC,kBAAU,UAHE;AAIZlC,gBAAS6B,OAAO,EAAR,GAAc;AAJV,OAAd;AAMAnC,iBAAWa,GAAX,CAAewB,OAAf;AACD;;AAED,aAASlC,MAAT,GAAkB;AAChB,UAAI,CAACV,KAAKC,IAAV,EAAgB;AAAE;AAAS;;AAE3BA,aAAOD,KAAKC,IAAZ;AACAC,cAAQF,KAAKE,KAAb;;AAEA,UAAIU,kBAAJ,EAAwB;AACtB4B;;AAEA,YAAI,CAACxC,KAAKgD,WAAV,EAAuB;AACrBlB;AACA5B,gBAAM+C,MAAN,CAAajD,IAAb,EAAmBK,OAAnB;AACAL,eAAKgD,WAAL,GAAmB,CAAnB;AACD;;AAED9C,cAAMgD,YAAN,CAAmBlD,IAAnB,EAAyBK,OAAzB;AACD;AACF;AACF;;qBA3EuBT,I;;;;AALjBmB,O;;AACAoC,O","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data, panel;\n  elem = elem.find('.svg-panel');\n  var svgelem = elem.find('svg');\n  var svgnode = svgelem.get(0);\n  var plotCanvas = elem.find('.plot-canvas');\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function formatter(label, slice) {\n    return \"<div style='font-size:\" + ctrl.panel.fontSize + \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n  }\n\n  function addSVG() {        \n    var xml = jQuery.parseXML(panel.svg_data);\n\n    svgelem.get(0).setAttribute(\"viewBox\", xml.documentElement.getAttribute(\"viewBox\"));\n    svgelem.html(xml.documentElement.children); \n    svgnode=svgelem.get(0);\n  }\n\n  function resizePlotCanvas() {\n    var width = elem.width();\n    var height = elem.height();\n\n    var size = Math.min(width, height);\n\n    var plotCss = {\n      top: '10px',\n      margin: 'auto',\n      position: 'relative',\n      height: (size - 20) + 'px'\n    };\n    plotCanvas.css(plotCss);\n  }\n   \n  function render() {\n    if (!ctrl.data) { return; }\n\n    data = ctrl.data;\n    panel = ctrl.panel;\n\n    if (setElementHeight()) { \n      resizePlotCanvas();\n            \n      if (!ctrl.initialized) {\n        addSVG();    \n        panel.doInit(ctrl, svgnode);\n        ctrl.initialized = 1;\n      }\n        \n      panel.handleMetric(ctrl, svgnode); \n    }\n  }\n}\n\n"]}