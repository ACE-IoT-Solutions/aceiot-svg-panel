{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","svgelem","getElementsByClassName","find","plotCanvas","svgnode","events","on","render","renderingCompleted","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","formatter","label","slice","fontSize","color","Math","round","percent","addSVG","parentSVG","SnapLib","default","paper","clear","childSVG","Snap","parse","svg_data","node","append","resizePlotCanvas","width","size","min","plotCss","top","margin","position","getAttribute","removeAttribute","initialized","doInit","handleMetric","$"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport 'jquery.flot';\r\nimport 'jquery.flot.pie';\r\nimport * as SnapLib  from './node_modules/snapsvg/dist/snap.svg-min.js';\r\n\r\nexport default function link(scope, elem, attrs, ctrl) {\r\n  var panel;\r\n  var svgelem = elem[0].getElementsByClassName('svg-object')[0];\r\n  elem = elem.find('.svg-panel');\r\n  var plotCanvas = elem.find('.plot-canvas');\r\n  var svgnode;\r\n\r\n  ctrl.events.on('render', function() {\r\n    render();\r\n    ctrl.renderingCompleted();\r\n  });\r\n\r\n  function setElementHeight() {\r\n    try {\r\n      var height = ctrl.height || panel.height || ctrl.row.height;\r\n      if (_.isString(height)) {\r\n        height = parseInt(height.replace('px', ''), 10);\r\n      }\r\n\r\n      height -= 5; // padding\r\n      height -= panel.title ? 24 : 9; // subtract panel title bar\r\n\r\n      elem.css('height', height + 'px');\r\n\r\n      return true;\r\n    } catch(e) { // IE throws errors sometimes\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function formatter(label, slice) {\r\n    return \"<div style='font-size:\" + ctrl.panel.fontSize + \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\r\n  }\r\n\r\n  function addSVG() {\r\n    let parentSVG = SnapLib.default(svgnode);\r\n    parentSVG.paper.clear();\r\n\r\n    let childSVG = Snap.parse(panel.svg_data);\r\n    parentSVG.node.append(childSVG.node);\r\n  } \r\n\r\n  function resizePlotCanvas() {\r\n    var width = elem.width();\r\n    var height = elem.height();\r\n\r\n    var size = Math.min(width, height);\r\n\r\n    var plotCss = {\r\n      top: '10px',\r\n      margin: 'auto',\r\n      position: 'relative',\r\n      height: (size) + 'px'\r\n    };\r\n    plotCanvas.css(plotCss);\r\n  }\r\n   \r\n  function render() {\r\n    panel = ctrl.panel;\r\n\r\n    if (setElementHeight()) { \r\n      if (svgelem) {\r\n      \tsvgnode = svgelem;\r\n      \t\r\n      \tif (svgnode.getAttribute(\"name\") == 'isInitial') {\r\n      \t  svgnode.removeAttribute(\"name\");\r\n      \t  ctrl.initialized = 0;\r\n        }\r\n      \r\n      \tresizePlotCanvas();\r\n            \r\n      \tif (!ctrl.initialized) {\r\n        \taddSVG();    \r\n        \tpanel.doInit(ctrl, svgnode);\r\n        \tctrl.initialized = 1;\r\n      \t}\r\n        \r\n      \tpanel.handleMetric(ctrl, svgnode); \r\n      \r\n      \tsvgnode = null;\r\n      }\r\n   \t  else {\r\n        ctrl.initialized = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n"]}